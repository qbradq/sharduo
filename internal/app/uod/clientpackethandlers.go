package uod

import (
	"github.com/qbradq/sharduo/internal/accounting"
	"github.com/qbradq/sharduo/internal/common"
	"github.com/qbradq/sharduo/internal/world"
	"github.com/qbradq/sharduo/pkg/uo"
)

type clientPacketHandler func(ns common.NetState, cp uo.ClientPacket)

var clientPacketHandlers = [256]clientPacketHandler{
	nil, //0x00
	nil, //0x01
	x02, //0x02
	nil, //0x03
	nil, //0x04
	nil, //0x05
	nil, //0x06
	nil, //0x07
	nil, //0x08
	nil, //0x09
	nil, //0x0a
	nil, //0x0b
	nil, //0x0c
	nil, //0x0d
	nil, //0x0e
	nil, //0x0f
	nil, //0x10
	nil, //0x11
	nil, //0x12
	nil, //0x13
	nil, //0x14
	nil, //0x15
	nil, //0x16
	nil, //0x17
	nil, //0x18
	nil, //0x19
	nil, //0x1a
	nil, //0x1b
	nil, //0x1c
	nil, //0x1d
	nil, //0x1e
	nil, //0x1f
	nil, //0x20
	nil, //0x21
	nil, //0x22
	nil, //0x23
	nil, //0x24
	nil, //0x25
	nil, //0x26
	nil, //0x27
	nil, //0x28
	nil, //0x29
	nil, //0x2a
	nil, //0x2b
	nil, //0x2c
	nil, //0x2d
	nil, //0x2e
	nil, //0x2f
	nil, //0x30
	nil, //0x31
	nil, //0x32
	nil, //0x33
	nil, //0x34
	nil, //0x35
	nil, //0x36
	nil, //0x37
	nil, //0x38
	nil, //0x39
	nil, //0x3a
	nil, //0x3b
	nil, //0x3c
	nil, //0x3d
	nil, //0x3e
	nil, //0x3f
	nil, //0x40
	nil, //0x41
	nil, //0x42
	nil, //0x43
	nil, //0x44
	nil, //0x45
	nil, //0x46
	nil, //0x47
	nil, //0x48
	nil, //0x49
	nil, //0x4a
	nil, //0x4b
	nil, //0x4c
	nil, //0x4d
	nil, //0x4e
	nil, //0x4f
	nil, //0x50
	nil, //0x51
	nil, //0x52
	nil, //0x53
	nil, //0x54
	nil, //0x55
	nil, //0x56
	nil, //0x57
	nil, //0x58
	nil, //0x59
	nil, //0x5a
	nil, //0x5b
	nil, //0x5c
	x5d, //0x5d
	nil, //0x5e
	nil, //0x5f
	nil, //0x60
	nil, //0x61
	nil, //0x62
	nil, //0x63
	nil, //0x64
	nil, //0x65
	nil, //0x66
	nil, //0x67
	nil, //0x68
	nil, //0x69
	nil, //0x6a
	nil, //0x6b
	nil, //0x6c
	nil, //0x6d
	nil, //0x6e
	nil, //0x6f
	nil, //0x70
	nil, //0x71
	nil, //0x72
	nil, //0x73
	nil, //0x74
	nil, //0x75
	nil, //0x76
	nil, //0x77
	nil, //0x78
	nil, //0x79
	nil, //0x7a
	nil, //0x7b
	nil, //0x7c
	nil, //0x7d
	nil, //0x7e
	nil, //0x7f
	x80, //0x80
	nil, //0x81
	nil, //0x82
	nil, //0x83
	nil, //0x84
	nil, //0x85
	nil, //0x86
	nil, //0x87
	nil, //0x88
	nil, //0x89
	nil, //0x8a
	nil, //0x8b
	nil, //0x8c
	nil, //0x8d
	nil, //0x8e
	nil, //0x8f
	nil, //0x90
	x91, //0x91
	nil, //0x92
	nil, //0x93
	nil, //0x94
	nil, //0x95
	nil, //0x96
	nil, //0x97
	nil, //0x98
	nil, //0x99
	nil, //0x9a
	nil, //0x9b
	nil, //0x9c
	nil, //0x9d
	nil, //0x9e
	nil, //0x9f
	xA0, //0xa0
	nil, //0xa1
	nil, //0xa2
	nil, //0xa3
	nil, //0xa4
	nil, //0xa5
	nil, //0xa6
	nil, //0xa7
	nil, //0xa8
	nil, //0xa9
	nil, //0xaa
	nil, //0xab
	nil, //0xac
	nil, //0xad
	nil, //0xae
	nil, //0xaf
	nil, //0xb0
	nil, //0xb1
	nil, //0xb2
	nil, //0xb3
	nil, //0xb4
	nil, //0xb5
	nil, //0xb6
	nil, //0xb7
	nil, //0xb8
	nil, //0xb9
	nil, //0xba
	nil, //0xbb
	nil, //0xbc
	nil, //0xbd
	nil, //0xbe
	nil, //0xbf
	nil, //0xc0
	nil, //0xc1
	nil, //0xc2
	nil, //0xc3
	nil, //0xc4
	nil, //0xc5
	nil, //0xc6
	nil, //0xc7
	nil, //0xc8
	nil, //0xc9
	nil, //0xca
	nil, //0xcb
	nil, //0xcc
	nil, //0xcd
	nil, //0xce
	nil, //0xcf
	nil, //0xd0
	nil, //0xd1
	nil, //0xd2
	nil, //0xd3
	nil, //0xd4
	nil, //0xd5
	nil, //0xd6
	nil, //0xd7
	nil, //0xd8
	nil, //0xd9
	nil, //0xda
	nil, //0xdb
	nil, //0xdc
	nil, //0xdd
	nil, //0xde
	nil, //0xdf
	nil, //0xe0
	nil, //0xe1
	nil, //0xe2
	nil, //0xe3
	nil, //0xe4
	nil, //0xe5
	nil, //0xe6
	nil, //0xe7
	nil, //0xe8
	nil, //0xe9
	nil, //0xea
	nil, //0xeb
	nil, //0xec
	nil, //0xed
	nil, //0xee
	nil, //0xef
	nil, //0xf0
	nil, //0xf1
	nil, //0xf2
	nil, //0xf3
	nil, //0xf4
	nil, //0xf5
	nil, //0xf6
	nil, //0xf7
	nil, //0xf8
	nil, //0xf9
	nil, //0xfa
	nil, //0xfb
	nil, //0xfc
	nil, //0xfd
	nil, //0xfe
	nil, //0xff
}

func x02(ns common.NetState, cp uo.ClientPacket) {
	p := cp.(uo.ClientPacketMove)
	ma := uo.NewServerPacketMoveAck(make([]byte, 0, 4), p.Key(), uo.NotoFriend)
	ns.SendPacket(ma)
}

func x5d(ns common.NetState, cp uo.ClientPacket) {
	// We only use one character slot
	// p := cp.(uo.ClientPacketCharacterLogin)
	world.ServiceRequest(&world.NewCharacterRequest{
		State: ns,
		Name:  "temp",
	})
}

func x80(ns common.NetState, cp uo.ClientPacket) {
	p := cp.(uo.ClientPacketAccountLogin)
	accounting.SendRequest(&accounting.LoginRequest{
		State:    ns,
		Username: p.Username(),
		Password: p.Password(),
	})
}

func x91(ns common.NetState, cp uo.ClientPacket) {
	p := cp.(uo.ClientPacketGameServerLogin)
	ns.BeginCompression()
	accounting.SendRequest(&accounting.GameServerLoginRequest{
		State:    ns,
		Username: p.Username(),
		Password: p.Password(),
	})
}

func xA0(ns common.NetState, cp uo.ClientPacket) {
	p := cp.(uo.ClientPacketSelectServer)
	accounting.SendRequest(&accounting.SelectServerRequest{
		State: ns,
		Slot:  p.ShardSelected(),
	})
}
